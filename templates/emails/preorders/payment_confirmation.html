{% extends "emails/base_email.html" %}
{% load static currency_tags %}

{% block title %}Payment Confirmed - {{ preorder.preorder_number }}{% endblock %

{% block content %}
<h1 style="color: #1f2937; font-size: 24px; margin-bottom: 20px;">
    ✅ Payment Confirmed!
</h1>

<p style="color: #4b5563; font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
    Hi {{ preorder.full_name }},
</p>

<p style="color: #4b5563; font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
    We've received your payment for pre-order <strong>{{ preorder.preorder_number }}</strong>. Thank you!
</p>

<!-- Payment Details Box -->
<div style="background-color: #d1fae5; border: 1px solid #10b981; border-radius: 12px; padding: 24px; margin-bottom: 24px;">
    <h2 style="color: #065f46; font-size: 18px; margin-bottom: 16px;">Payment Details</h2>
    
    <table style="width: 100%; border-collapse: collapse;">
        <tr>
            <td style="padding: 8px 0; color: #047857; font-size: 14px;">Amount Paid</td>
            <td style="padding: 8px 0; color: #065f46; font-size: 18px; font-weight: 700; text-align: right;">{% format_price payment.amount %}</td>
        </tr>
        <tr>
            <td style="padding: 8px 0; color: #047857; font-size: 14px;">Payment Method</td>
            <td style="padding: 8px 0; color: #065f46; font-size: 14px; text-align: right;">{{ payment.get_payment_method_display }}</td>
        </tr>
        <tr>
            <td style="padding: 8px 0; color: #047857; font-size: 14px;">Transaction ID</td>
            <td style="padding: 8px 0; color: #065f46; font-size: 14px; text-align: right; font-family: monospace;">{{ payment.transaction_id }}</td>
        </tr>
        <tr>
            <td style="padding: 8px 0; color: #047857; font-size: 14px;">Date</td>
            <td style="padding: 8px 0; color: #065f46; font-size: 14px; text-align: right;">{{ payment.paid_at|date:"M d, Y H:i" }}</td>
        </tr>
    </table>
</div>

<!-- Payment Progress -->
<div style="background-color: #f3f4f6; border-radius: 12px; padding: 24px; margin-bottom: 24px;">
    <h2 style="color: #1f2937; font-size: 18px; margin-bottom: 16px;">Payment Progress</h2>
    
    <table style="width: 100%; border-collapse: collapse;">
        <tr>
            <td style="padding: 8px 0; color: #6b7280; font-size: 14px;">Total Order Value</td>
            <td style="padding: 8px 0; color: #1f2937; font-size: 14px; text-align: right;">{% format_price preorder.final_price|default:preorder.estimated_total %}</td>
        </tr>
        <tr>
            <td style="padding: 8px 0; color: #6b7280; font-size: 14px;">Total Paid</td>
            <td style="padding: 8px 0; color: #10b981; font-size: 14px; font-weight: 600; text-align: right;">{% format_price preorder.deposit_paid %}</td>
        </tr>
        {% if remaining_amount > 0 %}
        <tr style="border-top: 1px solid #d1d5db;">
            <td style="padding: 12px 0 8px; color: #1f2937; font-size: 14px; font-weight: 600;">Remaining Balance</td>
            <td style="padding: 12px 0 8px; color: #ef4444; font-size: 16px; font-weight: 600; text-align: right;">{% format_price remaining_amount %}</td>
        </tr>
        {% else %}
        <tr style="border-top: 1px solid #d1d5db;">
            <td colspan="2" style="padding: 12px 0; text-align: center;">
                <span style="background-color: #10b981; color: white; padding: 6px 16px; border-radius: 999px; font-size: 14px; font-weight: 600;">
                    ✓ Fully Paid
                </span>
            </td>
        </tr>
        {% endif %}
    </table>
</div>

<!-- What's Next -->
<div style="border: 1px solid #e5e7eb; border-radius: 12px; padding: 24px; margin-bottom: 24px;">
    <h2 style="color: #1f2937; font-size: 18px; margin-bottom: 16px;">What Happens Next?</h2>
    <p style="color: #4b5563; font-size: 14px; line-height: 1.6; margin: 0;">
        {% if payment.payment_type == 'deposit' %}
        Your deposit has been received! Our team will now begin working on your order. You'll receive updates as your order progresses through production.
        {% elif payment.payment_type == 'final' %}
        Your final payment has been processed! Your order is now ready for shipping. You'll receive tracking information once it's dispatched.
        {% else %}
        Your payment has been received. We'll continue processing your order and keep you updated on its progress.
        {% endif %}
    </p>
</div>

<!-- CTA Button -->
<div style="text-align: center; margin-bottom: 24px;">
    <a href="{{ site_url }}{% url 'preorders:detail' preorder_number=preorder.preorder_number %}" 
       style="display: inline-block; background-color: #7c3aed; color: white; text-decoration: none; padding: 14px 32px; border-radius: 8px; font-weight: 600; font-size: 16px;">
        View Order Status
    </a>
</div>

<p style="color: #6b7280; font-size: 14px; line-height: 1.6; margin-bottom: 20px;">
    Keep this email for your records. If you have any questions about your order, feel free to contact us.
</p>

<p style="color: #4b5563; font-size: 16px; line-height: 1.6;">
    Thank you for your business!<br>
    <strong>The {{ site_name }} Team</strong>
</p>
{% endblock %}
