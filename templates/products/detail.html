{% extends 'base.html' %}
{% load static %}
{% load currency_tags %}

{% load seo_tags %}
{% block page_id %}product{% endblock %}
{% block title %}{{ product.meta_title|default:product.name|seo_title }} - {{ SITE_NAME }}{% endblock %}
{% block meta_description %}{{ product.meta_description|default:product.short_description|seo_desc }}{% endblock %}
{% block og_title %}{{ product.meta_title|default:product.name|seo_title }}{% endblock %}
{% block og_description %}{{ product.meta_description|default:product.short_description|seo_desc }}{% endblock %}
{% block og_image %}{% if product.images.first %}{{ product.images.first.image.url }}{% else %}{% static 'images/og-image.jpg' %}{% endif %}{% endblock %}

{% block content %}
<div id="product-detail" class="container mx-auto px-4 py-8" data-product-slug="{{ product.slug }}" data-product-id="{{ product.id }}">
    <!-- Breadcrumb -->
    <nav id="breadcrumbs" class="mb-8"></nav>

    <!-- Structured Data: Product + Breadcrumb -->
    <script type="application/ld+json" data-ld="product">
    {
      "@context": "https://schema.org",
      "@type": "Product",
      "name": "{{ product.name|escapejs }}",
      "image": [{% for img in product.images.all %}"{{ request.scheme }}://{{ request.get_host }}{{ img.image.url }}"{% if not forloop.last %}, {% endif %}{% endfor %}],
      "description": "{{ product.short_description|default:''|truncatechars:300|escapejs }}",
      "sku": "{{ product.sku|default:'' }}",
      {% if product.brand %}
      "brand": { "@type": "Brand", "name": "{{ product.brand.name|escapejs }}" },
      {% endif %}
      "offers": {
        "@type": "Offer",
        "url": "{{ request.build_absolute_uri }}",
        "priceCurrency": "{{ currency_code|default:'BDT' }}",
        "price": "{{ product.current_price }}",
        "availability": "https://schema.org/{% if product.stock_quantity > 0 %}InStock{% else %}OutOfStock{% endif %}"
      }{% if product.average_rating %},
      "aggregateRating": { "@type": "AggregateRating", "ratingValue": "{{ product.average_rating }}", "reviewCount": "{{ product.review_count }}" }
      {% endif %}
    }
    </script>

    <script type="application/ld+json" data-ld="breadcrumb">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "Home", "item": "{{ request.scheme }}://{{ request.get_host }}" }{% if product.category %},
        { "@type": "ListItem", "position": 2, "name": "{{ product.category.name|escapejs }}", "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'catalog:category-detail' product.category.slug %}" }{% endif %},
        { "@type": "ListItem", "position": 3, "name": "{{ product.name|escapejs }}", "item": "{{ request.build_absolute_uri }}" }
      ]
    }
    </script>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
        <!-- Product Images -->
        <div>
            <!-- Main Image -->
            <div class="aspect-square bg-gray-100 dark:bg-stone-800 rounded-lg overflow-hidden mb-4 shadow-sm hover:shadow-lg transition-shadow relative">
                {% if product.images.all %}
                <img id="main-image" src="{{ product.images.first.image.url }}" alt="{{ product.name }}" loading="lazy" decoding="async" class="w-full h-full object-cover">
                <!-- zoom hint -->
                <div class="absolute bottom-3 right-3 bg-black/40 text-white p-1 rounded-md text-xs flex items-center gap-1">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M11 19a8 8 0 100-16 8 8 0 000 16z"/></svg>
                    <span>Zoom</span>
                </div>
                {% else %}
                <div class="w-full h-full flex items-center justify-center">
                    <svg class="w-24 h-24 text-gray-300 dark:text-stone-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
                {% endif %}
            </div>
            
            <!-- Thumbnails -->
            {% if product.images.count > 1 %}
            <div class="grid grid-cols-5 gap-2" role="list" aria-label="Product images">
                {% for image in product.images.all %}
                <button onclick="changeImage('{{ image.image.url }}')" 
                        class="aspect-square bg-gray-100 dark:bg-stone-800 rounded-lg overflow-hidden border-2 border-transparent hover:border-primary-500 focus:border-primary-500 focus:outline-none transition-colors"
                        role="listitem" aria-label="View image {{ forloop.counter }}">
                    <img src="{{ image.image.url }}" alt="{{ product.name }}" loading="lazy" decoding="async" class="w-full h-full object-cover">
                </button>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        
        <!-- Product Info -->
        <div>
            <!-- Category & Brand -->
            <div class="flex items-center space-x-2 text-sm text-gray-500 dark:text-stone-400 mb-2">
                {% if product.category %}
                <a href="{% url 'catalog:category-detail' product.category.slug %}" class="hover:text-primary-600">
                    {{ product.category.name }}
                </a>
                {% endif %}
                {% if product.brand %}
                <span>â€¢</span>
                <a href="{% url 'catalog:product-list' %}?brand={{ product.brand.slug }}" class="hover:text-primary-600">
                    {{ product.brand.name }}
                </a>
                {% endif %}
            </div>
            
            <!-- Title -->
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{{ product.name }}</h1>

            <!-- Badges -->
            <div class="flex items-center space-x-2 mb-4" aria-hidden="false">
                {% if product.is_new %}
                <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-semibold">New</span>
                {% endif %}
                {% if product.is_bestseller %}
                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-semibold">Bestseller</span>
                {% endif %}
                {% if product.sale_price %}
                <span class="px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-semibold">On Sale</span>
                {% endif %}
                {% if product.is_featured %}
                <span class="px-2 py-1 bg-primary-100 text-primary-700 rounded text-xs font-semibold">Featured</span>
                {% endif %}
                {% if product.is_eco_friendly %}
                <span class="px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs font-semibold">Eco-friendly</span>
                {% endif %}
            </div>
            
            <!-- Rating -->
            {% if product.average_rating %}
            <div class="flex items-center space-x-4 mb-4">
                <div class="flex items-center">
                    <div class="flex text-yellow-400">
                        {% for i in "12345" %}
                        {% if forloop.counter <= product.average_rating %}
                        <svg class="w-5 h-5 fill-current" viewBox="0 0 20 20">
                            <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                        </svg>
                        {% else %}
                        <svg class="w-5 h-5 fill-current text-gray-300 dark:text-stone-600" viewBox="0 0 20 20">
                            <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                        </svg>
                        {% endif %}
                        {% endfor %}
                    </div>
                    <span class="ml-2 text-gray-600 dark:text-stone-300">{{ product.average_rating }}</span>
                </div>
                <a href="#reviews" class="text-primary-600 hover:text-primary-700">
                    {{ product.review_count }} reviews
                </a>
            </div>
            {% endif %}
            
            <!-- Price -->
            <div class="mb-6">
                {% if product.sale_price %}
                <div class="flex items-center space-x-4">
                    <span id="product-price" class="text-3xl font-bold text-red-600">{% format_price product.sale_price product.currency %}</span>
                    <span class="text-xl text-gray-400 dark:text-stone-500 line-through">{% format_price product.price product.currency %}</span>
                    {% if product.discount_percentage %}
                    <span class="bg-red-100 text-red-600 px-2 py-1 rounded text-sm font-semibold">
                        {{ product.discount_percentage }}% off
                    </span>
                    {% endif %}
                </div>
                {% else %}
                <span id="product-price" class="text-3xl font-bold text-gray-900 dark:text-white">{% format_price product.price product.currency %}</span>
                {% endif %}
            </div>
            
            <!-- Short Description -->
            {% if product.short_description %}
            <p class="text-gray-600 dark:text-stone-300 mb-6">{{ product.short_description }}</p>
            {% endif %}
            
            <!-- Variants -->
            {% if product.variants.all and product.variants.all|length > 0 %}
            <div class="mb-6">
                {% regroup product.variants.all by attribute_type as variant_groups %}
                {% for group in variant_groups %}
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-stone-200 mb-2">{{ group.grouper }}</label>
                    <div class="flex flex-wrap gap-2">
                        {% for variant in group.list %}
                        <button type="button" 
                                onclick="selectVariant('{{ variant.id }}', '{{ group.grouper }}', '{{ variant.attribute_value }}')"
                                class="variant-btn px-4 py-2 border border-gray-300 dark:border-stone-700 rounded-lg hover:border-primary-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-colors"
                                data-variant="{{ variant.id }}"
                                data-type="{{ group.grouper }}"
                                data-price="{{ variant.price|default:'' }}"
                                data-stock="{{ variant.stock_quantity|default:0 }}">
                            {{ variant.attribute_value }}
                        </button>
                        <!-- Hidden radio input for JS to check -->
                        <input type="radio" name="variant" value="{{ variant.id }}" data-price="{{ variant.price|default:'' }}" data-stock="{{ variant.stock_quantity|default:0 }}" style="display:none;" autocomplete="off">
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Quantity & Add to Cart -->
            <div class="flex items-center space-x-4 mb-6">
                <div class="flex items-center border border-gray-300 dark:border-stone-700 rounded-lg">
                    <button id="decrease-qty" class="px-2 py-2 text-gray-600 dark:text-stone-300 hover:text-primary-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                        </svg>
                    </button>
                    <input type="number" id="quantity" value="1" min="1" max="{{ product.stock_quantity }}"
                           class="w-16 text-center border-0 focus:ring-0">
                    <button id="increase-qty" class="px-2 py-2 text-gray-600 dark:text-stone-300 hover:text-primary-600">
                        <svg class="w-6 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v12m6-6H6"></path>
                        </svg>
                    </button>
                </div>
                
                {% if product.stock_quantity > 0 %}
                <button id="add-to-cart-btn"
                        class="flex-1 bg-primary-600 hover:bg-primary-700 text-white py-3 px-6 rounded-lg font-semibold transition-colors">
                    Add to Cart
                </button>
                {% else %}
                <button class="flex-1 bg-gray-300 dark:bg-stone-600 text-gray-500 dark:text-stone-400 py-3 px-6 rounded-lg font-semibold cursor-not-allowed" disabled>
                    Out of Stock
                </button>
                {% endif %}

                <button id="add-to-wishlist-btn"
                    class="p-2 border border-gray-300 dark:border-stone-700 rounded-lg hover:border-primary-500 hover:text-red-500 transition-colors dark:hover:text-red-400"
                    title="Add to Wishlist" aria-pressed="false">
                    <svg class="w-7 h-7" stroke="currentColor" viewBox="0 0 24 24">
                        <path class="heart-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                        </path>
                        <path class="heart-fill opacity-0 hover:opacity-100 transition-opacity duration-150" fill="currentColor"
                            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                </button>
                
                <button id="add-to-compare-btn"
                    class="p-2 border border-gray-300 dark:border-stone-700 rounded-lg hover:border-primary-500 hover:text-primary-600 transition-colors"
                    title="Compare product" aria-pressed="false">
                    <svg class="w-7 h-7 text-gray-600 dark:text-stone-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 6h9M10 12h9M10 18h9M4 6h.01M4 12h.01M4 18h.01" />
                    </svg>
                </button>
            </div>

            <!-- Stock Status (updated dynamically via JS) -->
            <div id="stock-status" class="mb-6" aria-live="polite">
                {% if product.stock_quantity > 10 %}
                <span class="text-green-600 flex items-center">
                    <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    In Stock
                </span>
                {% elif product.stock_quantity > 0 %}
                <span class="text-orange-500 flex items-center">
                    <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    Only {{ product.stock_quantity }} left
                </span>
                {% else %}
                <span class="text-red-600 flex items-center">
                    <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                    </svg>
                    Out of Stock
                </span>
                {% endif %}
            </div>
            
            <!-- SKU -->
            <div class="text-sm text-gray-500 dark:text-stone-400 mb-6">
                <span>SKU: {{ product.sku }}</span>
            </div>
            
            <!-- Share -->
            <div class="flex items-center space-x-4 border-t pt-6">
                <span class="text-gray-600 dark:text-stone-300">Share:</span>
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" 
                   target="_blank" class="text-gray-400 dark:text-stone-500 hover:text-blue-600">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/>
                    </svg>
                </a>
                <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ product.name }}" 
                   target="_blank" class="text-gray-400 dark:text-stone-500 hover:text-blue-400">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
                    </svg>
                </a>
                <a href="https://pinterest.com/pin/create/button/?url={{ request.build_absolute_uri }}&description={{ product.name }}" 
                   target="_blank" class="text-gray-400 dark:text-stone-500 hover:text-red-600">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0c-6.627 0-12 5.372-12 12 0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738.098.119.112.224.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.631-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146 1.124.347 2.317.535 3.554.535 6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>
    
    <!-- Mobile Sticky Add-to-Cart -->
    <div id="mobile-sticky-atc" class="fixed inset-x-4 bottom-4 z-40 lg:hidden">
        <div class="bg-white dark:bg-stone-900 shadow-lg rounded-xl p-3 flex items-center gap-3">
            <div class="flex-1">
                {% if product.sale_price %}
                <div class="text-sm text-gray-500 dark:text-stone-400">Now</div>
                <div class="font-semibold text-lg text-red-600">{% format_price product.sale_price product.currency %} <span class="text-sm line-through text-gray-400 dark:text-stone-500">{% format_price product.price product.currency %}</span></div>
                {% else %}
                <div class="font-semibold text-lg">{% format_price product.price product.currency %}</div>
                {% endif %}
                <div id="mobile-stock" class="text-xs text-gray-500 dark:text-stone-400">{% if product.stock_quantity > 0 %}In stock{% else %}Out of stock{% endif %}</div>
            </div>
            {% if product.stock_quantity > 0 %}
            <button id="mobile-add-to-cart" class="bg-primary-600 text-white px-4 py-2 rounded-lg font-semibold">Add</button>
            {% else %}
            <button class="bg-gray-300 dark:bg-stone-600 text-gray-500 dark:text-stone-400 px-4 py-2 rounded-lg font-semibold cursor-not-allowed" disabled>Out</button>
            {% endif %}
        </div>
    </div>

    <!-- Product Details Tabs -->
    <div class="mt-16">
        <div id="product-tabs-component" class="mb-4"></div>
        <div id="legacy-tab-content" class="hidden">
            <!-- Description Tab -->
            <div id="description-tab" class="tab-content py-8">
                <div class="prose max-w-none">
                    {{ product.description|safe }}
                </div>
            </div>
            
            <!-- Specifications Tab -->
            <div id="specifications-tab" class="tab-content py-8">
                {% if product.specifications %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for spec in product.specifications %}
                    <div class="flex border-b border-gray-100 py-2">
                        <span class="font-medium text-gray-900 dark:text-white w-1/3">{{ spec.key }}</span>
                        <span class="text-gray-600 dark:text-stone-300">{{ spec.value }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 dark:text-stone-400">No specifications available.</p>
                {% endif %}
            </div>
            
            <!-- Reviews Tab -->
            <div id="reviews-tab" class="tab-content py-8">
                <div id="reviews-section">
                    <!-- Reviews will be loaded here -->
                    <p class="text-gray-500 dark:text-stone-400">Loading reviews...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Related Products -->
    <section id="related-products" class="mt-16">
        <h2 class="text-2xl font-bold mb-8">Related Products</h2>
        <div class="products-grid grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            {% if related_products %}
            {% for related in related_products %}
            {% include 'products/partials/product_card.html' with product=related %}
            {% endfor %}
            {% else %}
            <!-- Loaded via JS -->
            {% for i in "1234" %}
            <div class="skeleton h-80 rounded-2xl"></div>
            {% endfor %}
            {% endif %}
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<!-- Product page JS is handled by static/js/pages/product.js -->
<script>
    function selectVariant(variantId, group, value) {
        // Find the corresponding input and check it
        var input = document.querySelector('input[name="variant"][value="' + variantId + '"]');
        var btn = document.querySelector('button[data-variant="' + variantId + '"]');
        if (btn) {
            // update visual state
            document.querySelectorAll('.variant-btn').forEach(function(b){ b.classList.remove('border-primary-500','bg-primary-50','text-primary-700'); b.setAttribute('aria-checked', 'false'); });
            btn.classList.add('border-primary-500','bg-primary-50','text-primary-700');
            btn.setAttribute('aria-checked', 'true');
        }
        if (input) {
            input.checked = true;
            input.dispatchEvent(new Event('change', { bubbles: true }));
        }
    }
</script>
<script>
    function changeImage(imageUrl) {
        // Find the main product image element by id
        var mainImage = document.getElementById('main-image');
        if (mainImage) {
            mainImage.src = imageUrl;
        }
    }
</script>
<script>
    // Pass server-side data to the JS module (strings for safety)
    window.BUNORAA_PRODUCT = {
        id: "{{ product.id|default_if_none:''|escapejs }}",
        slug: "{{ product.slug|default_if_none:''|escapejs }}",
        name: "{{ product.name|default_if_none:''|escapejs }}",
        price: "{{ product.price|default_if_none:'0'|escapejs }}",
        salePrice: "{{ product.sale_price|default_if_none:''|escapejs }}",
        stock: "{{ product.stock_quantity|default_if_none:'0'|escapejs }}",
        sku: "{{ product.sku|default_if_none:''|escapejs }}",
        currency: "{{ currency_code|default:'BDT' }}",
        hasVariants: {{ product.variants.all|length|yesno:"true,false" }},

        images: [{% for img in product.images.all %}"{{ img.image.url }}"{% if not forloop.last %}, {% endif %}{% endfor %}],
        badges: {
            is_new: {{ product.is_new|default_if_none:False|yesno:'true,false' }},
            is_bestseller: {{ product.is_bestseller|default_if_none:False|yesno:'true,false' }},
            is_on_sale: {{ product.sale_price|default_if_none:''|length|yesno:'true,false' }},
            is_featured: {{ product.is_featured|default_if_none:False|yesno:'true,false' }},
            is_eco_friendly: {{ product.is_eco_friendly|default_if_none:False|yesno:'true,false' }}
        }
    };
</script>
{% endblock %}