{% load static %}

<div class="flex flex-col lg:flex-row gap-8 p-6 bg-white dark:bg-gray-900 rounded-lg shadow-xl animate-fade-in">
    <!-- Product Image Gallery -->
    <div class="lg:w-1/2 flex flex-col items-center">
        <div class="relative w-full aspect-square rounded-lg overflow-hidden shadow-md mb-4">
            <img id="quick-view-main-image" src="{{ product.image.url }}" alt="{{ product.name }}"
                 class="w-full h-full object-cover object-center transition-transform duration-300 hover:scale-105">
            {% if product.is_discounted and product.discount_percentage > 0 %}
            <span class="absolute top-3 left-3 bg-red-600 text-white text-xs font-semibold px-2.5 py-1 rounded-full shadow-lg">-{{ product.discount_percentage }}%</span>
            {% endif %}
        </div>
        {% if product.images.all|length > 1 %}
        <div class="flex gap-3 overflow-x-auto pb-2 custom-scrollbar">
            {% for img in product.images.all %}
            <img src="{{ img.image.url }}" alt="{{ product.name }} thumbnail {{ forloop.counter }}"
                 class="w-20 h-20 object-cover rounded-md border-2 border-transparent hover:border-blue-500 cursor-pointer transition-all duration-200"
                 onclick="document.getElementById('quick-view-main-image').src='{{ img.image.url }}'">
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <!-- Product Details -->
    <div class="lg:w-1/2 space-y-5">
        <h2 class="text-3xl lg:text-4xl font-extrabold text-gray-900 dark:text-white leading-tight">{{ product.name }}</h2>
        <p class="text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wider">{{ product.category.name }} {% if product.brand %}• {{ product.brand.name }}{% endif %}</p>

        <!-- Price Section -->
        <div class="flex items-center gap-4">
            {% if product.is_discounted %}
                <span class="text-3xl font-bold text-green-600 dark:text-green-400">৳{{ product.discounted_price|floatformat:2 }}</span>
                <span class="text-lg text-gray-500 dark:text-gray-400 line-through">৳{{ product.price|floatformat:2 }}</span>
                <span class="text-sm font-semibold text-red-500 bg-red-100 dark:bg-red-900 px-2 py-0.5 rounded-full">Save {{ product.discount_percentage }}%</span>
            {% else %}
                <span class="text-3xl font-bold text-gray-900 dark:text-white">৳{{ product.price|floatformat:2 }}</span>
            {% endif %}
        </div>

        <p class="text-gray-700 dark:text-gray-300 leading-relaxed">{{ product.short_description }}</p>

        <!-- Stock and Availability -->
        <div class="flex items-center space-x-2 text-base font-medium">
            {% if product.stock > 0 %}
                <i class="fas fa-check-circle text-green-500"></i>
                <span class="text-green-600 dark:text-green-400">In Stock</span>
                <span class="text-gray-500 dark:text-gray-400">({{ product.stock }} available)</span>
            {% else %}
                <i class="fas fa-times-circle text-red-500"></i>
                <span class="text-red-600 dark:text-red-400">Out of Stock</span>
            {% endif %}
        </div>

        <!-- Add to Cart Form -->
        <form hx-post="/cart/api/items/"
              hx-target="#product-quick-view-content"
              hx-swap="innerHTML"
              class="flex flex-col sm:flex-row items-stretch sm:items-center gap-4 mt-6"
              x-data="{ quantity: 1, maxStock: {{ product.stock }} }">
            {% csrf_token %}
            <input type="hidden" name="product_id" value="{{ product.id }}">
            <input type="hidden" name="override" value="false">
            <input type="hidden" name="saved_for_later" value="false">

            <div class="flex items-center border border-gray-300 dark:border-gray-700 rounded-lg overflow-hidden flex-shrink-0">
                <button type="button" @click="quantity = Math.max(1, quantity - 1)"
                        class="px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 transition-colors duration-200">
                    <i class="fas fa-minus"></i>
                </button>
                <input type="number" name="quantity" x-model="quantity" min="1" :max="maxStock"
                       class="w-20 text-center border-x border-gray-300 dark:border-gray-700 focus:ring-0 focus:outline-none bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-lg py-2">
                <button type="button" @click="quantity = Math.min(maxStock, quantity + 1)"
                        class="px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 transition-colors duration-200">
                    <i class="fas fa-plus"></i>
                </button>
            </div>

            <button type="submit"
                    {% if product.stock == 0 %}disabled{% endif %}
                    class="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-all duration-300 ease-in-out transform hover:scale-105 shadow-lg hover:shadow-xl
                           {% if product.stock == 0 %}opacity-50 cursor-not-allowed{% endif %}">
                <i class="fas fa-cart-plus mr-2"></i> Add to Cart
            </button>
        </form>

        <!-- Go to Product Page -->
        <a href="{{ product.get_absolute_url }}" class="block text-center text-blue-600 dark:text-blue-400 hover:underline mt-5 text-base font-medium flex items-center justify-center">
            View Full Product Details <i class="fas fa-arrow-right ml-2"></i>
        </a>
    </div>
</div>
