{% load i18n %}
<aside
  class="md:w-1/4 bg-white dark:bg-gray-900 p-6 rounded-2xl shadow-xl sticky top-20 max-h-[calc(100vh-5rem)] overflow-auto text-sm font-medium"
  id="filter-sidebar-content"
>
  <form method="get" id="filter-form" class="space-y-8">

    <!-- Header -->
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-2xl font-bold text-gray-900 dark:text-white">{% translate "Filters" %}</h3>
      <a href="{{ request.path }}"
         class="text-sm text-red-600 hover:text-red-800 font-semibold transition">
        {% translate "Clear All" %}
      </a>
    </div>

    <!-- CATEGORY FILTER -->
    <section class="filter-section" data-section="category" data-expanded="true">
      <button type="button"
              class="filter-toggle w-full flex justify-between items-center py-2 text-left text-gray-800 dark:text-white font-semibold text-lg hover:text-pink-600 transition">
        <span>{% translate "Categories" %}</span>
        <svg class="filter-icon-closed w-5 h-5 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
        <svg class="filter-icon-open hidden w-5 h-5 transform rotate-180 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>

      <div class="filter-content space-y-2 mt-2">
        <ul class="space-y-1 max-h-64 overflow-y-auto pr-1">
          {% for category in categories_list %}
          <li>
            <label
              class="flex items-center space-x-2 cursor-pointer
              {% if not category.parent %}
                font-semibold text-gray-900 dark:text-white text-base
              {% else %}
                pl-6 text-sm text-gray-600 dark:text-gray-300
              {% endif %}">
              <input type="checkbox"
                     name="category"
                     value="{{ category.slug }}"
                     class="form-checkbox accent-pink-600 border-gray-400 dark:border-gray-600"
                     {% if category.slug in current_filters.category %}checked{% endif %}>
              <span>{{ category.name }}</span>
            </label>
          </li>
          {% endfor %}
        </ul>
      </div>
    </section>

    <!-- COLOR FILTER -->
    <section class="filter-section" data-section="color" data-expanded="false">
      <button type="button"
              class="filter-toggle w-full flex justify-between items-center py-2 text-left text-gray-800 dark:text-white font-semibold text-lg hover:text-pink-600 transition">
        <span>{% translate "Color" %}</span>
        <svg class="filter-icon-closed w-5 h-5 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
        <svg class="filter-icon-open hidden w-5 h-5 transform rotate-180 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>

      <div class="filter-content hidden mt-3 space-y-2">
        {% for color in filter_options.color %}
        <label class="flex items-center space-x-2 text-gray-700 dark:text-gray-200">
          <input type="checkbox" name="color" value="{{ color.id }}"
                 class="accent-pink-600 border-gray-300 dark:border-gray-600"
                 {% if color.id|stringformat:'s' in current_filters.color %}checked{% endif %}>
          <span class="text-sm">{{ color.name }}</span>
        </label>
        {% endfor %}
      </div>
    </section>

    <!-- FABRIC FILTER -->
    <section class="filter-section" data-section="fabric" data-expanded="false">
      <button type="button"
              class="filter-toggle w-full flex justify-between items-center py-2 text-left text-gray-800 dark:text-white font-semibold text-lg hover:text-pink-600 transition">
        <span>{% translate "Fabric" %}</span>
        <svg class="filter-icon-closed w-5 h-5 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
        <svg class="filter-icon-open hidden w-5 h-5 transform rotate-180 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <div class="filter-content hidden mt-3 space-y-2">
        {% for fabric in filter_options.fabric %}
        <label class="flex items-center space-x-2 text-gray-700 dark:text-gray-200">
          <input type="checkbox" name="fabric" value="{{ fabric.id }}"
                 class="accent-pink-600 border-gray-300 dark:border-gray-600"
                 {% if fabric.id|stringformat:'s' in current_filters.fabric %}checked{% endif %}>
          <span class="text-sm">{{ fabric.name }}</span>
        </label>
        {% endfor %}
      </div>
    </section>

    <!-- SIZE FILTER -->
    <section class="filter-section" data-section="size" data-expanded="false">
      <button type="button"
              class="filter-toggle w-full flex justify-between items-center py-2 text-left text-gray-800 dark:text-white font-semibold text-lg hover:text-pink-600 transition">
        <span>{% translate "Size" %}</span>
        <svg class="filter-icon-closed w-5 h-5 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
        <svg class="filter-icon-open hidden w-5 h-5 transform rotate-180 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <div class="filter-content hidden mt-3 space-y-2">
        {% for size in filter_options.size %}
        <label class="flex items-center space-x-2 text-gray-700 dark:text-gray-200">
          <input type="checkbox" name="size" value="{{ size.id }}"
                 class="accent-pink-600 border-gray-300 dark:border-gray-600"
                 {% if size.id|stringformat:'s' in current_filters.size %}checked{% endif %}>
          <span class="text-sm">{{ size.name }}</span>
        </label>
        {% endfor %}
      </div>
    </section>

    <!-- FIT FILTER -->
    <section class="filter-section" data-section="fit" data-expanded="false">
      <button type="button"
              class="filter-toggle w-full flex justify-between items-center py-2 text-left text-gray-800 dark:text-white font-semibold text-lg hover:text-pink-600 transition">
        <span>{% translate "Cut / Fit" %}</span>
        <svg class="filter-icon-closed w-5 h-5 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
        <svg class="filter-icon-open hidden w-5 h-5 transform rotate-180 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <div class="filter-content hidden mt-3 space-y-2">
        {% for fit in filter_options.fit %}
        <label class="flex items-center space-x-2 text-gray-700 dark:text-gray-200">
          <input type="checkbox" name="fit" value="{{ fit.id }}"
                 class="accent-pink-600 border-gray-300 dark:border-gray-600"
                 {% if fit.id|stringformat:'s' in current_filters.fit %}checked{% endif %}>
          <span class="text-sm">{{ fit.name }}</span>
        </label>
        {% endfor %}
      </div>
    </section>

    <!-- PRICE RANGE -->
    <section class="filter-section" data-section="price" data-expanded="false">
      <button type="button"
              class="filter-toggle w-full flex justify-between items-center py-2 text-left text-gray-800 dark:text-white font-semibold text-lg hover:text-pink-600 transition">
        <span>{% translate "Price Range" %}</span>
        <svg class="filter-icon-closed w-5 h-5 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
        <svg class="filter-icon-open hidden w-5 h-5 transform rotate-180 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <div class="filter-content hidden mt-3 space-y-2">
        <div class="flex gap-3">
          <input type="number" name="min_price" placeholder="{% translate 'Min' %}"
                 value="{{ current_filters.min_price }}"
                 class="w-1/2 rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 text-sm dark:bg-gray-800 dark:text-white focus:ring-pink-500">
          <input type="number" name="max_price" placeholder="{% translate 'Max' %}"
                 value="{{ current_filters.max_price }}"
                 class="w-1/2 rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 text-sm dark:bg-gray-800 dark:text-white focus:ring-pink-500">
        </div>
      </div>
    </section>
  </form>

  <!-- Filter toggle script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById("filter-form");
      
      // Auto-submit on checkbox/input change
      form.querySelectorAll('input').forEach(input => {
        input.addEventListener('change', () => form.submit());
      });
      
      // Filter section toggle
      document.querySelectorAll('.filter-section').forEach(section => {
        const toggle = section.querySelector('.filter-toggle');
        const content = section.querySelector('.filter-content');
        const iconClosed = section.querySelector('.filter-icon-closed');
        const iconOpen = section.querySelector('.filter-icon-open');
        const isExpanded = section.dataset.expanded === 'true';
        
        // Set initial state
        if (isExpanded) {
          content.classList.remove('hidden');
          iconClosed.classList.add('hidden');
          iconOpen.classList.remove('hidden');
        }
        
        toggle.addEventListener('click', () => {
          const isNowExpanded = content.classList.contains('hidden');
          content.classList.toggle('hidden');
          iconClosed.classList.toggle('hidden');
          iconOpen.classList.toggle('hidden');
          section.dataset.expanded = isNowExpanded;
        });
      });
    });
  </script>
</aside>
