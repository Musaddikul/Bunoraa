{% load i18n %}
{% load static %}
{% load currency_filters %}

<div class="product-card bg-white dark:bg-dark/70 rounded-3xl shadow-xl overflow-hidden transform transition duration-300 hover:scale-[1.02] hover:shadow-2xl flex flex-col justify-between animate-fadeIn">
    
    {% with product_url=product.get_absolute_url %}
    <a href="{% if product_url %}{{ product_url }}{% else %}{% url 'products:all_products' %}{% endif %}"
       class="block relative h-60 overflow-hidden group">

        <img src="{{ product.image.url|default:'https://placehold.co/600x400/E0E0E0/4A4A4A?text=No+Image' }}"
             alt="{{ product.name }}"
             class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
             onerror="this.onerror=null;this.src='https://placehold.co/600x400/E0E0E0/4A4A4A?text={% translate 'No Image' %}';">

        <!-- Wishlist -->
        <div class="absolute top-2 right-2 z-20">
          <button type="button" 
                  class="wishlist-toggle p-2 rounded-full bg-white/80 dark:bg-gray-800/80 hover:bg-white dark:hover:bg-gray-800 transition-all shadow-sm"
                  data-product-id="{{ product.id }}"
                  aria-label="Add to wishlist">
            {% if product.is_wished %}
            <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
              <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
            </svg>
            {% else %}
            <svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
            </svg>
            {% endif %}
          </button>
        </div>
    </a>
    {% endwith %}

    <div class="p-5 flex-grow flex flex-col justify-between">
        <h2 class="text-lg md:text-xl font-semibold text-gray-800 dark:text-light font-display mb-3 leading-snug tracking-tight">
            {{ product.name|truncatechars:35 }}
        </h2>

        <div class="flex items-center justify-between">
            {% if product.is_discounted %}
            <div class="flex flex-col">
                <span class="text-sm text-gray-500 dark:text-gray-400 line-through">{{ product.price|convert_price:selected_currency }}</span>
                <span class="text-2xl font-bold text-primary dark:text-accent">{{ product.discounted_price|convert_price:selected_currency }}</span>
            </div>
            {% else %}
            <span class="text-2xl font-bold text-primary dark:text-accent">{{ product.price|convert_price:selected_currency }}</span>
            {% endif %}

            {% with product_url=product.get_absolute_url %}
            <a href="{% if product_url %}{{ product_url }}{% else %}{% url 'products:all_products' %}{% endif %}"
               class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-secondary hover:bg-secondary-700 text-white shadow transition duration-200">
                {% translate "View" %}
                <svg class="ml-2 w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                          d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" />
                </svg>
            </a>
            {% endwith %}
        </div>
    </div>
</div>