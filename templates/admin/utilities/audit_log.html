{% extends "admin/base_site.html" %}
{% load i18n %}

{% block title %}{{ title }} | {{ site_title }}{% endblock %}

{% block content %}
<style>
    :root {
        --util-bg: #ffffff;
        --util-border: #e5e7eb;
        --util-text: #374151;
        --util-text-muted: #6b7280;
        --util-primary: #3b82f6;
    }
    
    @media (prefers-color-scheme: dark) {
        :root {
            --util-bg: #1f2937;
            --util-border: #374151;
            --util-text: #f3f4f6;
            --util-text-muted: #9ca3af;
        }
    }
    
    html[data-theme="dark"] {
        --util-bg: #1f2937;
        --util-border: #374151;
        --util-text: #f3f4f6;
        --util-text-muted: #9ca3af;
    }
    
    .util-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px;
    }
    
    .util-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
    }
    
    .util-header h1 {
        font-size: 24px;
        font-weight: 700;
        color: var(--util-text);
        margin: 0;
    }
    
    .filter-bar {
        background: var(--util-bg);
        border: 1px solid var(--util-border);
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
    }
    
    .filter-bar select {
        padding: 8px 12px;
        border: 1px solid var(--util-border);
        border-radius: 6px;
        font-size: 14px;
        background: var(--util-bg);
        color: var(--util-text);
    }
    
    .filter-bar button {
        padding: 8px 16px;
        background: var(--util-primary);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
    }
    
    .log-table {
        width: 100%;
        background: var(--util-bg);
        border: 1px solid var(--util-border);
        border-radius: 8px;
        overflow: hidden;
    }
    
    .log-table th,
    .log-table td {
        padding: 12px 16px;
        text-align: left;
        border-bottom: 1px solid var(--util-border);
    }
    
    .log-table th {
        background: var(--util-border);
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--util-text-muted);
    }
    
    .log-table td {
        font-size: 14px;
        color: var(--util-text);
    }
    
    .log-table tr:last-child td {
        border-bottom: none;
    }
    
    .log-table tr:hover td {
        background: rgba(0,0,0,0.02);
    }
    
    .action-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
    }
    
    .action-badge.add { background: #dcfce7; color: #166534; }
    .action-badge.change { background: #dbeafe; color: #1e40af; }
    .action-badge.delete { background: #fee2e2; color: #991b1b; }
    
    .log-user {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .log-user-avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: var(--util-border);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
    }
    
    .log-time {
        color: var(--util-text-muted);
        font-size: 12px;
    }
    
    .empty-state {
        text-align: center;
        padding: 48px;
        color: var(--util-text-muted);
    }
</style>

<div class="util-container">
    <div class="util-header">
        <h1>ðŸ“‹ {{ title }}</h1>
    </div>
    
    <form method="get" class="filter-bar">
        <select name="user">
            <option value="">{% trans "All Users" %}</option>
            {% for user in staff_users %}
            <option value="{{ user.id }}" {% if selected_user == user.id|stringformat:"s" %}selected{% endif %}>{{ user.email }}</option>
            {% endfor %}
        </select>
        
        <select name="action">
            <option value="">{% trans "All Actions" %}</option>
            <option value="1" {% if selected_action == "1" %}selected{% endif %}>{% trans "Add" %}</option>
            <option value="2" {% if selected_action == "2" %}selected{% endif %}>{% trans "Change" %}</option>
            <option value="3" {% if selected_action == "3" %}selected{% endif %}>{% trans "Delete" %}</option>
        </select>
        
        <select name="content_type">
            <option value="">{% trans "All Models" %}</option>
            {% for ct in content_types %}
            <option value="{{ ct.id }}" {% if selected_content_type == ct.id|stringformat:"s" %}selected{% endif %}>{{ ct.app_label }}.{{ ct.model }}</option>
            {% endfor %}
        </select>
        
        <select name="days">
            <option value="1" {% if selected_days == 1 %}selected{% endif %}>{% trans "Last 24 hours" %}</option>
            <option value="7" {% if selected_days == 7 %}selected{% endif %}>{% trans "Last 7 days" %}</option>
            <option value="30" {% if selected_days == 30 %}selected{% endif %}>{% trans "Last 30 days" %}</option>
            <option value="90" {% if selected_days == 90 %}selected{% endif %}>{% trans "Last 90 days" %}</option>
        </select>
        
        <button type="submit">{% trans "Filter" %}</button>
    </form>
    
    {% if logs %}
    <table class="log-table">
        <thead>
            <tr>
                <th>{% trans "Time" %}</th>
                <th>{% trans "User" %}</th>
                <th>{% trans "Action" %}</th>
                <th>{% trans "Model" %}</th>
                <th>{% trans "Object" %}</th>
                <th>{% trans "Details" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>
                    <span class="log-time">{{ log.action_time|timesince }} ago</span>
                </td>
                <td>
                    <div class="log-user">
                        <span class="log-user-avatar">{{ log.user.email|slice:":1"|upper }}</span>
                        <span>{{ log.user.email }}</span>
                    </div>
                </td>
                <td>
                    <span class="action-badge {% if log.action_flag == 1 %}add{% elif log.action_flag == 2 %}change{% else %}delete{% endif %}">
                        {% if log.action_flag == 1 %}{% trans "Add" %}
                        {% elif log.action_flag == 2 %}{% trans "Change" %}
                        {% else %}{% trans "Delete" %}{% endif %}
                    </span>
                </td>
                <td>{{ log.content_type.model|title }}</td>
                <td>{{ log.object_repr|truncatechars:50 }}</td>
                <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">{{ log.change_message|truncatechars:100 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <p>{% trans "No audit logs found for the selected filters." %}</p>
    </div>
    {% endif %}
</div>
{% endblock %}