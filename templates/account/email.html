{% extends "account/base_manage.html" %}
{% load static allauth i18n widget_tweaks %}

{% block head_title %}{% trans "Email Addresses" %}{% endblock %}

{% block manage_content %}
<div class="max-w-3xl mx-auto space-y-8 p-6 bg-background-light dark:bg-background-dark rounded-3xl shadow-2xl border border-light dark:border-dark/50">
    <div class="text-center mb-8">
        <h2 class="text-3xl font-extrabold text-dark dark:text-light">{% trans "Manage Your Email Addresses" %}</h2>
        <p class="mt-2 text-lg text-gray-600 dark:text-gray-300">{% trans "The following email addresses are associated with your account." %}</p>
    </div>

    {% if emailaddresses %}
        <div class="space-y-4">
            <form action="{% url 'account_email' %}" method="post">
                {% csrf_token %}
                <div class="space-y-4">
                    {% for radio in emailaddress_radios %}
                        {% with emailaddress=radio.emailaddress %}
                        <div class="flex items-center justify-between p-4 border rounded-lg transition-all duration-300 {% if emailaddress.primary %}border-primary-500 dark:border-primary-700 ring-2 ring-primary-200{% else %}border-light/50 dark:border-dark/50 hover:border-light/70 dark:hover:border-dark/70{% endif %}">
                            <div class="flex items-center">
                                {% render_field field class="h-5 w-5 text-primary-600 focus:ring-primary-500 border-light/50 rounded-full dark:border-dark/50 transition-colors duration-300" %}
                                <label for="{{ radio.id }}" class="ml-4 flex flex-col">
                                    <span class="font-medium text-dark dark:text-light">{{ emailaddress.email }}</span>
                                    <div class="flex items-center space-x-2 mt-1">
                                        {% if emailaddress.verified %}
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">{% trans "Verified" %}</span>
                                        {% else %}
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">{% trans "Unverified" %}</span>
                                        {% endif %}
                                        {% if emailaddress.primary %}
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">{% trans "Primary" %}</span>
                                        {% endif %}
                                    </div>
                                </label>
                            </div>
                        </div>
                        {% endwith %}
                    {% endfor %}
                </div>

                <div class="mt-6 flex flex-wrap gap-3 border-t border-light/50 dark:border-dark/50 pt-6">
                    <button type="submit" name="action_primary" class="w-full sm:w-auto flex justify-center py-3 px-6 border border-transparent rounded-lg shadow-lg text-base font-semibold text-white bg-gradient-to-r from-primary-500 to-primary-700 hover:from-primary-600 hover:to-primary-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transform hover:-translate-y-0.5 transition-all duration-300">{% trans 'Make Primary' %}</button>
                    <button type="submit" name="action_send" class="w-full sm:w-auto flex justify-center py-3 px-6 border border-light/50 dark:border-dark/50 rounded-lg shadow-sm bg-background-light dark:bg-dark/50 text-base font-medium text-dark/70 dark:text-light/70 hover:bg-light/70 dark:hover:bg-dark/70 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-300">{% trans 'Re-send Verification' %}</button>
                    <button type="submit" name="action_remove" class="w-full sm:w-auto flex justify-center py-3 px-6 border border-transparent rounded-lg shadow-lg text-base font-semibold text-white bg-gradient-to-r from-red-500 to-red-700 hover:from-red-600 hover:to-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transform hover:-translate-y-0.5 transition-all duration-300">{% trans 'Remove' %}</button>
                </div>
            </form>
        </div>
    {% else %}
        {% include "account/snippets/warn_no_email.html" %}
    {% endif %}

    {% if can_add_email %}
        <div class="mt-8 space-y-4">
            <h3 class="text-2xl font-bold text-dark dark:text-light">{% trans "Add a New Email Address" %}</h3>
            <form method="post" action="{% url 'account_email' %}" class="mt-6 space-y-6">
                {% csrf_token %}
                {% for field in form %}
                    <div class="relative z-0 w-full mb-6 group">
                        {% render_field field class="peer block w-full px-4 py-3 rounded-lg bg-light/50 dark:bg-dark/50 border border-light/50 dark:border-dark/50 text-dark dark:text-light focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-300 placeholder-transparent" placeholder=" " %}
                        <label for="{{ field.id_for_label }}" class="absolute text-sm text-dark/70 dark:text-light/70 duration-300 transform -translate-y-4 scale-75 top-1/2 left-3 z-10 origin-[0] bg-background-light dark:bg-background-dark px-2 peer-focus:px-2 peer-focus:text-primary-600 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-3 peer-focus:scale-75 peer-focus:-translate-y-6">
                            {{ field.label }}
                        </label>
                        {% if field.help_text %}
                            <p class="mt-2 text-xs text-dark/70 dark:text-light/70">{{ field.help_text }}</p>
                        {% endif %}
                        {% for error in field.errors %}
                            <p class="mt-2 text-xs text-red-600 dark:text-red-400">{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endfor %}
                <div>
                    <button name="action_add" type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-base font-semibold text-white bg-gradient-to-r from-primary-500 to-primary-700 hover:from-primary-600 hover:to-primary-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transform hover:-translate-y-0.5 transition-all duration-300">
                        {% trans "Add Email" %}
                    </button>
                </div>
            </form>
        </div>
    {% endif %}
</div>
{% endblock manage_content %}

{% block extra_body %}
    <script type="text/javascript">
        (function() {
            const form = document.querySelector('form[action="{% url 'account_email' %}"]');
            if (form) {
                const removeButton = form.querySelector('button[name="action_remove"]');
                if (removeButton) {
                    removeButton.addEventListener('click', function(e) {
                        if (!confirm("{% blocktranslate %}Do you really want to remove the selected email address?{% endblocktranslate %}")) {
                            e.preventDefault();
                        }
                    });
                }
            }
        })();
    </script>
{% endblock %}
