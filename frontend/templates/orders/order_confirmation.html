{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load currency_tags %}

{% block title %}{% trans "Order Confirmed" %} - #{{ order.order_number }}{% endblock %}
{% block page_name %}order-confirmation{% endblock %}

{% block content %}
<div class="section bg-secondary-50 min-h-screen">
    <div class="container max-w-4xl">
        <!-- Success Header -->
        <div class="text-center mb-8">
            <div class="w-20 h-20 rounded-full bg-success-100 flex items-center justify-center mx-auto mb-4 animate-fade-in">
                <svg class="w-10 h-10 text-success-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-secondary-900 mb-2">{% trans "Thank you for your order!" %}</h1>
            <p class="text-lg text-secondary-600">{% trans "Your order has been placed successfully." %}</p>
        </div>
        
        <!-- Order Info Card -->
        <div class="card mb-6">
            <div class="card-body">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div class="p-4 bg-secondary-50 rounded-lg">
                        <p class="text-sm text-secondary-500 mb-1">{% trans "Order Number" %}</p>
                        <p class="font-bold text-secondary-900">#{{ order.order_number }}</p>
                    </div>
                    <div class="p-4 bg-secondary-50 rounded-lg">
                        <p class="text-sm text-secondary-500 mb-1">{% trans "Date" %}</p>
                        <p class="font-bold text-secondary-900">{{ order.created_at|date:"M d, Y" }}</p>
                    </div>
                    <div class="p-4 bg-secondary-50 rounded-lg">
                        <p class="text-sm text-secondary-500 mb-1">{% trans "Total" %}</p>
                        <p class="font-bold text-primary-600">{{ order.total|currency }}</p>
                    </div>
                    <div class="p-4 bg-secondary-50 rounded-lg">
                        <p class="text-sm text-secondary-500 mb-1">{% trans "Payment Method" %}</p>
                        <p class="font-bold text-secondary-900">{{ order.get_payment_method_display }}</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Confirmation Email -->
        <div class="alert alert-info mb-6">
            <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
            </svg>
            <div>
                <p class="font-medium">{% trans "Confirmation email sent" %}</p>
                <p class="text-sm">{% trans "We've sent the order details to" %} <strong>{{ order.email }}</strong></p>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Order Items -->
            <div class="lg:col-span-2">
                <div class="card">
                    <div class="card-header">
                        <h2 class="text-lg font-semibold text-secondary-900">{% trans "Order Items" %}</h2>
                    </div>
                    <div class="card-body divide-y divide-secondary-200">
                        {% for item in order.items.all %}
                        <div class="py-4 flex gap-4 {% if forloop.first %}pt-0{% endif %} {% if forloop.last %}pb-0{% endif %}">
                            <img 
                                src="{{ item.product.primary_image.url }}" 
                                alt="{{ item.product.name }}" 
                                class="w-20 h-20 object-cover rounded-lg flex-shrink-0"
                            >
                            <div class="flex-1 min-w-0">
                                <h3 class="font-medium text-secondary-900 line-clamp-1">{{ item.product.name }}</h3>
                                {% if item.variant %}
                                <p class="text-sm text-secondary-500">{{ item.variant }}</p>
                                {% endif %}
                                <p class="text-sm text-secondary-500">{% trans "Qty:" %} {{ item.quantity }}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-semibold text-secondary-900">{{ item.total|currency }}</p>
                                <p class="text-sm text-secondary-500">{{ item.unit_price|currency }} {% trans "each" %}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- What's Next -->
                <div class="card mt-6">
                    <div class="card-header">
                        <h2 class="text-lg font-semibold text-secondary-900">{% trans "What's Next?" %}</h2>
                    </div>
                    <div class="card-body">
                        <div class="space-y-4">
                            <div class="flex gap-4">
                                <div class="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0">
                                    <span class="font-bold text-primary-600">1</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-secondary-900">{% trans "Order Processing" %}</h4>
                                    <p class="text-sm text-secondary-600">{% trans "We're preparing your order for shipment." %}</p>
                                </div>
                            </div>
                            <div class="flex gap-4">
                                <div class="w-10 h-10 rounded-full bg-secondary-100 flex items-center justify-center flex-shrink-0">
                                    <span class="font-bold text-secondary-600">2</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-secondary-900">{% trans "Shipping Confirmation" %}</h4>
                                    <p class="text-sm text-secondary-600">{% trans "You'll receive a tracking number once shipped." %}</p>
                                </div>
                            </div>
                            <div class="flex gap-4">
                                <div class="w-10 h-10 rounded-full bg-secondary-100 flex items-center justify-center flex-shrink-0">
                                    <span class="font-bold text-secondary-600">3</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-secondary-900">{% trans "Delivery" %}</h4>
                                    <p class="text-sm text-secondary-600">{% trans "Expected delivery:" %} <strong>{{ order.estimated_delivery|date:"M d, Y" }}</strong></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Order Summary Sidebar -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Addresses -->
                <div class="card">
                    <div class="card-body">
                        <div class="mb-4">
                            <h3 class="font-medium text-secondary-900 mb-2">{% trans "Shipping Address" %}</h3>
                            <div class="text-sm text-secondary-600">
                                <p class="font-medium text-secondary-900">{{ order.shipping_address.full_name }}</p>
                                <p>{{ order.shipping_address.address_line_1 }}</p>
                                {% if order.shipping_address.address_line_2 %}
                                <p>{{ order.shipping_address.address_line_2 }}</p>
                                {% endif %}
                                <p>{{ order.shipping_address.city }}, {{ order.shipping_address.state }} {{ order.shipping_address.postal_code }}</p>
                                <p>{{ order.shipping_address.country.name }}</p>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="font-medium text-secondary-900 mb-2">{% trans "Billing Address" %}</h3>
                            <div class="text-sm text-secondary-600">
                                {% if order.same_billing_address %}
                                <p>{% trans "Same as shipping address" %}</p>
                                {% else %}
                                <p class="font-medium text-secondary-900">{{ order.billing_address.full_name }}</p>
                                <p>{{ order.billing_address.address_line_1 }}</p>
                                {% if order.billing_address.address_line_2 %}
                                <p>{{ order.billing_address.address_line_2 }}</p>
                                {% endif %}
                                <p>{{ order.billing_address.city }}, {{ order.billing_address.state }} {{ order.billing_address.postal_code }}</p>
                                <p>{{ order.billing_address.country.name }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Order Totals -->
                <div class="card">
                    <div class="card-body">
                        <h3 class="font-semibold text-secondary-900 mb-4">{% trans "Order Summary" %}</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-secondary-600">{% trans "Subtotal" %}</span>
                                <span class="text-secondary-900">{{ order.subtotal|currency }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-secondary-600">{% trans "Shipping" %}</span>
                                <span class="text-secondary-900">
                                    {% if order.shipping_cost == 0 %}
                                    <span class="text-success-600">{% trans "Free" %}</span>
                                    {% else %}
                                    {{ order.shipping_cost|currency }}
                                    {% endif %}
                                </span>
                            </div>
                            {% if order.discount > 0 %}
                            <div class="flex justify-between text-success-600">
                                <span>{% trans "Discount" %}</span>
                                <span>-{{ order.discount|currency }}</span>
                            </div>
                            {% endif %}
                            <div class="flex justify-between">
                                <span class="text-secondary-600">{% trans "Tax" %}</span>
                                <span class="text-secondary-900">{{ order.tax|currency }}</span>
                            </div>
                            <div class="border-t border-secondary-200 pt-2 mt-2 flex justify-between font-semibold text-lg">
                                <span class="text-secondary-900">{% trans "Total" %}</span>
                                <span class="text-primary-600">{{ order.total|currency }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="space-y-3">
                    <a href="{% url 'orders:detail' order.order_number %}" class="btn btn-primary w-full">
                        {% trans "View Order Details" %}
                    </a>
                    {% if order.can_track %}
                    <a href="{% url 'orders:track' order.order_number %}" class="btn btn-outline w-full">
                        {% trans "Track Order" %}
                    </a>
                    {% endif %}
                    <a href="{% url 'storefront:home' %}" class="btn btn-secondary w-full">
                        {% trans "Continue Shopping" %}
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Help Section -->
        <div class="mt-8 text-center">
            <p class="text-secondary-600">
                {% trans "Need help with your order?" %}
                <a href="{% url 'support:contact' %}" class="text-primary-600 hover:underline">{% trans "Contact Support" %}</a>
            </p>
        </div>
    </div>
</div>
{% endblock %}
